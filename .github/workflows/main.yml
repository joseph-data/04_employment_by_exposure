# Sync this repository to a Hugging Face Space on every push to `main`.
# The push uses a `HF_TOKEN` secret (write access) and Git LFS for large files.
name: Sync to Hugging Face hub
on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  workflow_dispatch:

# Least-privilege: we only need to read the repo contents.
permissions:
  contents: read
  
jobs:
  check-file-size:
    runs-on: ubuntu-latest
    steps:
      # Checkout without LFS so large files stored in Git LFS are represented as
      # small pointer files; this job is meant to catch non-LFS large files.
      - uses: actions/checkout@v3
      - name: Check large files
        run: |
          LIMIT=10485760
          echo "Fail if any tracked file exceeds $LIMIT bytes (~10MB)"
          LARGE_FILES=$(find . -type f \
            -not -path "./.git/*" \
            -not -path "./.github/workflows/*" \
            -size +${LIMIT}c)
          if [ -n "$LARGE_FILES" ]; then
            echo "The following files exceed the limit:"
            echo "$LARGE_FILES"
            exit 1
          fi
          echo "No files larger than 10MB detected."

  sync-to-hub:
    needs: check-file-size
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          # Full history + LFS needed to push to Hugging Face over git.
          fetch-depth: 0
          lfs: true
      - name: Push to hub
        env:
          # Create this in the repo settings: Settings → Secrets and variables → Actions.
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: git push https://joseph-data:$HF_TOKEN@huggingface.co/spaces/joseph-data/employment_ai main
